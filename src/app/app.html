<div class="app-shell">
  <header class="site-header">
    <div class="container header-row">
      <div class="logo">Ecom<span>Hub</span></div>
      <nav class="nav">
        <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Home</a>
        <a routerLink="/shop" routerLinkActive="active">Shop</a>
        <a routerLink="/contact" routerLinkActive="active">Cart</a>
        <a
          routerLink="/admin"
          routerLinkActive="active"
          *ngIf="(user$ | async)?.role === 'admin'"
        >
          Admin
        </a>
      </nav>
      <div class="header-actions">
        <div class="search">
          <input
            type="text"
            placeholder="Search products..."
            (input)="updateHeaderSearch($event)"
          />
          <span class="search-icon">‚åï</span>
        </div>
        <button class="icon-btn badge-btn" aria-label="Wishlist">
          ‚ô°
          <span class="badge-count" *ngIf="favoritesCount$ | async as count">
            {{ count }}
          </span>
        </button>
        <button class="icon-btn badge-btn" aria-label="Cart">
          üõç
          <span class="badge-count" *ngIf="cartCount$ | async as count">
            {{ count }}
          </span>
        </button>
        <ng-container *ngIf="user$ | async as user; else authButtons">
          <div class="user-pill">
            <span class="user-icon">üë§</span>
            <span>{{ user.username }}</span>
            <span class="role">{{ user.role }}</span>
          </div>
          <button class="btn ghost" (click)="logout()">Sign out</button>
        </ng-container>
        <ng-template #authButtons>
          <button class="btn ghost" (click)="openAuth('register')">Register</button>
          <button class="btn primary" (click)="openAuth('login')">Sign in</button>
        </ng-template>
      </div>
    </div>
  </header>

  <main class="page-content">
    <router-outlet />
  </main>

  <section class="newsletter-banner">
    <div class="container newsletter-inner">
      <div>
        <h3>Stay up to date about our latest offers</h3>
        <p class="muted">
          Join our newsletter for new arrivals, promos, and exclusive drops.
        </p>
      </div>
      <div class="newsletter-form">
        <input type="email" placeholder="Enter your email address" />
        <button class="btn ghost">Subscribe</button>
      </div>
    </div>
  </section>

  <footer class="site-footer">
    <div class="container footer-grid">
      <div>
        <div class="logo footer-logo">Ecom<span>Hub</span></div>
        <p class="muted">
          Curated e-commerce essentials inspired by modern design. Build your store
          with style and clarity.
        </p>
        <div class="socials">
          <span>Instagram</span>
          <span>Twitter</span>
          <span>Dribbble</span>
        </div>
      </div>
      <div>
        <h4>Shop</h4>
        <ul>
          <li>New arrivals</li>
          <li>Best sellers</li>
          <li>Accessories</li>
          <li>Gift cards</li>
        </ul>
      </div>
      <div>
        <h4>Company</h4>
        <ul>
          <li>About us</li>
          <li>Careers</li>
          <li>Press</li>
          <li>Contact</li>
        </ul>
      </div>
      <div>
        <h4>Help</h4>
        <ul>
          <li>Customer support</li>
          <li>Delivery details</li>
          <li>Terms & conditions</li>
          <li>Privacy policy</li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <span>¬© 2026 EcomHub. All rights reserved.</span>
      <span>Privacy ‚Ä¢ Terms</span>
    </div>
  </footer>
</div>

<div class="modal-backdrop" *ngIf="isAuthOpen()">
  <div class="auth-modal">
    <div class="auth-header">
      <h3>{{ authTab() === 'login' ? 'Welcome back' : 'Create your account' }}</h3>
      <button class="icon-btn" (click)="closeAuth()" aria-label="Close">‚úï</button>
    </div>
    <div class="auth-tabs">
      <button
        class="tab"
        [ngClass]="{ active: authTab() === 'login' }"
        (click)="openAuth('login')"
      >
        Sign in
      </button>
      <button
        class="tab"
        [ngClass]="{ active: authTab() === 'register' }"
        (click)="openAuth('register')"
      >
        Register
      </button>
    </div>
    <form
      class="auth-form"
      *ngIf="authTab() === 'login'; else registerFormTpl"
      [formGroup]="loginForm"
      (ngSubmit)="submitLogin()"
    >
      <label>
        Email or username
        <input
          type="text"
          placeholder="you@email.com or username"
          formControlName="email"
        />
      </label>
      <span class="field-error" *ngIf="getLoginError('email')">
        {{ getLoginError('email') }}
      </span>
      <label>
        Password
        <input type="password" placeholder="password" formControlName="password" />
      </label>
      <span class="field-error" *ngIf="getLoginError('password')">
        {{ getLoginError('password') }}
      </span>
      <div class="auth-actions">
        <button class="btn primary" type="submit" [disabled]="isAuthLoading()">
          {{ isAuthLoading() ? 'Signing in...' : 'Sign in' }}
        </button>
        <button class="btn ghost" type="button" (click)="openAuth('register')">
          Create account
        </button>
      </div>
      <p class="muted small">
        Use the email you registered with to sign in.
      </p>
    </form>

    <ng-template #registerFormTpl>
      <form class="auth-form" [formGroup]="registerForm" (ngSubmit)="submitRegister()">
        <label>
          First name
          <input type="text" placeholder="firstname" formControlName="firstname" />
        </label>
        <span class="field-error" *ngIf="getRegisterError('firstname')">
          {{ getRegisterError('firstname') }}
        </span>
        <label>
          Last name
          <input type="text" placeholder="lastname" formControlName="lastname" />
        </label>
        <span class="field-error" *ngIf="getRegisterError('lastname')">
          {{ getRegisterError('lastname') }}
        </span>
        <label>
          Email
          <input type="email" placeholder="you@email.com" formControlName="email" />
        </label>
        <span class="field-error" *ngIf="getRegisterError('email')">
          {{ getRegisterError('email') }}
        </span>
        <label>
          Username
          <input type="text" placeholder="username" formControlName="username" />
        </label>
        <span class="field-error" *ngIf="getRegisterError('username')">
          {{ getRegisterError('username') }}
        </span>
        <label>
          Password
          <input type="password" placeholder="password" formControlName="password" />
        </label>
        <span class="field-error" *ngIf="getRegisterError('password')">
          {{ getRegisterError('password') }}
        </span>
        <label>
          Confirm password
          <input type="password" placeholder="confirm password" formControlName="confirmPassword" />
        </label>
        <span class="field-error" *ngIf="getRegisterError('confirmPassword')">
          {{ getRegisterError('confirmPassword') }}
        </span>
        <span class="field-error" *ngIf="getPasswordMismatchError()">
          {{ getPasswordMismatchError() }}
        </span>
        <label>
          Role
          <select formControlName="role">
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
        </label>
        <div class="auth-actions">
          <button class="btn primary" type="submit" [disabled]="isAuthLoading()">
            {{ isAuthLoading() ? 'Creating...' : 'Create account' }}
          </button>
          <button class="btn ghost" type="button" (click)="openAuth('login')">
            Back to sign in
          </button>
        </div>
      </form>
    </ng-template>
    <p class="muted small" *ngIf="authMessage()">{{ authMessage() }}</p>
    <p class="muted small">
      By continuing you agree to our terms and privacy policy.
    </p>
  </div>
</div>
